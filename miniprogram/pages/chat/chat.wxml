<!--chat.wxml-->
<view class="chat-container">
  <!-- Status bar spacer -->
  <view class="status-bar-spacer" style="height: {{statusBarHeight}}px;"></view>

  <!-- Header -->
  <view class="chat-header" style="padding-right: {{headerRightPadding}}px;">
    <view class="header-title">Orcheo</view>
    <view class="header-actions">
      <view class="clear-btn" bindtap="clearChat">
        <text class="clear-text">清空对话</text>
      </view>
    </view>
  </view>

  <!-- Messages Area -->
  <scroll-view
    class="messages-area"
    scroll-y
    scroll-into-view="{{scrollToView}}"
    scroll-with-animation
    enhanced
    show-scrollbar="{{false}}"
    bindtap="onMessagesAreaTap"
  >
    <view class="messages-wrapper">
      <block wx:for="{{messages}}" wx:key="id">
        <view
          id="msg-{{item.id}}"
          class="message-row {{item.role === 'user' ? 'user-row' : 'assistant-row'}}"
        >
          <view class="message-bubble {{item.role === 'user' ? 'user-bubble' : 'assistant-bubble'}}">
            <view wx:if="{{item.role === 'assistant'}}" class="avatar assistant-avatar">
              <image class="avatar-image" src="/images/orcheo.svg" mode="aspectFill"></image>
            </view>
            <view class="message-content {{item.role === 'assistant' && !item.content && isLoading ? 'loading-content' : ''}}">
              <block wx:if="{{item.role === 'assistant' && !item.content && isLoading}}">
                <view class="typing-indicator">
                  <view class="typing-dot"></view>
                  <view class="typing-dot"></view>
                  <view class="typing-dot"></view>
                </view>
              </block>
              <block wx:else>
                <text class="message-text">{{item.content}}</text>
              </block>
            </view>
            <view wx:if="{{item.role === 'user'}}" class="avatar user-avatar">
              <view class="user-icon">
                <view class="user-icon-head"></view>
                <view class="user-icon-body"></view>
              </view>
            </view>
          </view>
        </view>
      </block>

      <!-- Bottom padding for scroll -->
      <view class="scroll-padding"></view>
    </view>
  </scroll-view>

  <!-- Input Area -->
  <view class="input-area" style="margin-bottom: {{keyboardHeight}}px;">
    <view class="input-wrapper">
      <input
        class="message-input"
        type="text"
        placeholder="给 Orcheo 发消息..."
        placeholder-class="placeholder-text"
        value="{{inputValue}}"
        bindinput="onInputChange"
        bindconfirm="onConfirm"
        confirm-type="send"
        adjust-position="{{false}}"
        cursor-spacing="20"
        hold-keyboard="{{true}}"
        focus="{{inputFocus}}"
        bindkeyboardheightchange="onKeyboardHeightChange"
      />
      <view
        class="send-btn {{inputValue.length > 0 && !isLoading ? 'send-btn-active' : ''}}"
        catchtouchend="onSendMessage"
      >
        <view class="send-icon">
          <text class="arrow-up">↑</text>
        </view>
      </view>
    </view>
    <view class="input-footer" wx:if="{{keyboardHeight === 0}}">
      <text class="footer-text">Powered by Orcheo</text>
    </view>
  </view>
</view>
